<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—”í¬ì¼“ | ê±´êµ­ëŒ€í•™êµ ì „ë ¥ ì‚¬ìš©ëŸ‰ í™•ì¸ ì„œë¹„ìŠ¤</title>
    <meta name="description" content="ê±´êµ­ëŒ€í•™êµ ì‚¬íšŒí™˜ê²½ê³µí•™ë¶€ ì—ì½” ìŠ¤ë§ˆíŠ¸ ì‹œí‹° í”„ë¡œì íŠ¸ì˜ ì¼í™˜ì¸ ì—”í¬ì¼“ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.">
    
    <!-- [TRACKING CODE START] -->
    <!-- ì‚¬ìš©ì ì¶”ì  ì½”ë“œë¥¼ ì—¬ê¸°ì— ì‚½ì…í•˜ì„¸ìš” -->
    <!-- [TRACKING CODE END] -->

    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=GmarketSans:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; color: #1e293b; overflow-x: hidden; }
        
        /* Design Tokens */
        .text-mint { color: #2dd4bf; } 
        .bg-mint { background-color: #2dd4bf; }
        .border-mint { border-color: #2dd4bf; }
        .text-ku { color: #036b3f; } 
        .bg-ku { background-color: #036b3f; }
        
        .gradient-text { background: linear-gradient(135deg, #036b3f 0%, #2dd4bf 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .gradient-coin { background: linear-gradient(135deg, #fbbf24 0%, #d97706 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* Interactions */
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }
        .transition-all { transition: all 0.3s ease; }
        .battle-bar-fill { transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* Highlight Animation */
        @keyframes highlight-pulse {
            0% { box-shadow: 0 0 0 0 rgba(45, 212, 191, 0.7); border-color: #2dd4bf; transform: scale(1); }
            50% { box-shadow: 0 0 0 10px rgba(45, 212, 191, 0); border-color: #2dd4bf; transform: scale(1.02); }
            100% { box-shadow: 0 0 0 0 rgba(45, 212, 191, 0); transform: scale(1); }
        }
        .highlighted-card { animation: highlight-pulse 1.5s ease-out; border: 2px solid #2dd4bf !important; }

        /* Modal & Tabs */
        .modal { opacity: 0; visibility: hidden; transition: all 0.3s ease; z-index: 100; }
        .modal.active { opacity: 1; visibility: visible; }
        .modal-content { transform: scale(0.95); transition: all 0.3s ease; }
        .modal.active .modal-content { transform: scale(1); }
        
        .tab-btn.active { border-bottom: 3px solid #2dd4bf; color: #0f766e; font-weight: 700; }
        .tab-btn { color: #64748b; font-weight: 500; }
        
        .hidden-page { display: none !important; }
        .font-slogan { font-family: 'GmarketSans', sans-serif; }

        /* Animations */
        @keyframes pulse-ring { 0% { box-shadow: 0 0 0 0 rgba(45, 212, 191, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(45, 212, 191, 0); } 100% { box-shadow: 0 0 0 0 rgba(45, 212, 191, 0); } }
        .btn-pulse { animation: pulse-ring 2s infinite; }
        .bounce-slow { animation: bounce 3s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        /* Custom Select */
        .battle-select {
            appearance: none; background-color: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2);
            color: white; padding: 0.4rem 2rem 0.4rem 0.8rem; border-radius: 0.5rem; font-weight: bold; cursor: pointer; width: 100%;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='white' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.4rem center; background-repeat: no-repeat; background-size: 1.2em 1.2em;
        }
        .battle-select option { background-color: #1e293b; color: white; }
    </style>
</head>
<body class="bg-slate-50">

    <!-- ================= NAV BAR ================= -->
    <nav class="bg-white/90 backdrop-blur-md border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 h-16 flex justify-between items-center">
            <!-- Logo -->
            <div class="flex items-center gap-1 cursor-pointer group" onclick="switchPage('dashboard')">
                <i class="fa-solid fa-bolt text-3xl text-mint drop-shadow-sm group-hover:scale-110 transition-transform"></i>
                <span class="text-xl font-black tracking-tight text-slate-900 ml-1">En-Pocket</span>
            </div>
            
            <!-- Dashboard Menu -->
            <div id="nav-dashboard-menu" class="hidden md:flex flex-grow max-w-md mx-8 relative">
                <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                <select id="globalSearch" onchange="scrollToBuilding(this.value)" class="w-full bg-slate-100 border-none rounded-full py-2 pl-10 pr-4 text-sm focus:ring-2 focus:ring-teal-400 cursor-pointer text-slate-600 font-medium hover:bg-slate-200 transition">
                    <option value="">ê±´ë¬¼ë³„ ì—ë„ˆì§€ ë¦¬í¬íŠ¸ ê²€ìƒ‰ (ê°€~í•˜)</option>
                </select>
            </div>

            <!-- Buttons -->
            <div class="flex gap-3 text-sm font-medium items-center">
                <div id="nav-dashboard-links" class="flex gap-4 items-center">
                    <a href="#competition" class="text-slate-500 hover:text-teal-600 transition hidden sm:block">ì—ë„ˆì§€ ëŒ€í•­ì „</a>
                    <button onclick="switchPage('campaign')" class="text-teal-700 font-bold bg-teal-50 px-4 py-2 rounded-full hover:bg-teal-100 transition flex items-center gap-2 border border-teal-100 shadow-sm btn-pulse">
                        <i class="fa-solid fa-coins text-yellow-500"></i> ì½”ì¸ ìº í˜ì¸
                    </button>
                </div>
                <div id="nav-campaign-links" class="hidden">
                    <button onclick="switchPage('dashboard')" class="text-slate-500 hover:text-teal-600 transition flex items-center gap-1 font-bold">
                        <i class="fa-solid fa-arrow-left"></i> ëŒ€ì‹œë³´ë“œ ë³µê·€
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ================= PAGE 1: DASHBOARD ================= -->
    <main id="page-dashboard">
        <div class="bg-slate-900 text-slate-400 text-xs py-2 text-center" id="systemStatus">
            <i class="fa-solid fa-database mr-2"></i> ë°ì´í„° ê¸°ì¤€: 2026ë…„ <span class="text-white font-bold" id="currentMonthDisplay">1ì›”</span> (ì „ë…„ ë™ì›” ëŒ€ë¹„ ë¶„ì„)
        </div>

        <header class="relative bg-white pt-16 pb-12 px-4 overflow-hidden text-center">
            <div class="max-w-4xl mx-auto relative z-10">
                <div class="inline-flex items-center gap-2 bg-teal-50 border border-teal-100 px-4 py-1.5 rounded-full mb-6">
                    <span class="w-2 h-2 rounded-full bg-mint animate-pulse"></span>
                    <span class="text-xs font-bold text-teal-700 uppercase tracking-wide">Petersen êµìˆ˜ ì—°êµ¬ ì¸ìš© í”„ë¡œì íŠ¸</span>
                </div>
                <h1 class="text-4xl md:text-5xl font-black text-slate-900 leading-tight mb-6">
                    ì „ë ¥ì‚¬ìš©ëŸ‰ì„ ë³´ê¸°ë§Œ í•´ë„<br>
                    <span class="gradient-text">ì „ë ¥ê°ì¶•ì´ ëœë‹¤ë©´ ë¯¿ìœ¼ì‹œë‚˜ìš”?</span>
                </h1>
                <p class="text-lg text-slate-600 mb-8 leading-relaxed max-w-2xl mx-auto">
                    ì˜¤ë²Œë¦° ëŒ€í•™ì€ ì‹¤ì‹œê°„ í”¼ë“œë°±ìœ¼ë¡œ 32%ë¥¼ ì ˆê°í–ˆìŠµë‹ˆë‹¤.<br>
                    ê³¼ì—° <strong class="text-ku">ê±´êµ­ëŒ€í•™êµ</strong>ëŠ” ì–´ë–¤ ë³€í™”ë¥¼ ê°€ì ¸ì˜¬ê¹Œìš”?<br>
                    <span class="text-slate-800 font-bold mt-2 block">ì´ì œ ì—”í¬ì¼“ê³¼ í•¨ê»˜ ìš°ë¦¬ ìº í¼ìŠ¤ì˜ ë³€í™”ë¥¼ ì‹œì‘í•©ì‹œë‹¤.</span>
                </p>
                
                <div class="flex flex-col items-center justify-center mb-8">
                    <p class="text-sm text-slate-600 font-bold mb-3 bg-slate-100 px-5 py-2 rounded-full border border-slate-200">
                        <i class="fa-solid fa-handshake-simple text-ku mr-2"></i>ì €í¬ En-Pocketì€ ê±´êµ­ëŒ€í•™êµ ì¤‘ì•™í™˜ê²½ë™ì•„ë¦¬ <strong>CES</strong>ì™€ í•¨ê»˜í•©ë‹ˆë‹¤.
                    </p>
                    <a href="https://www.instagram.com/campus_energy_saver" target="_blank" 
                       class="group flex items-center gap-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-3 rounded-xl font-bold hover:shadow-lg hover:shadow-pink-500/30 transition-all">
                        <i class="fa-brands fa-instagram text-xl group-hover:scale-110 transition-transform"></i>
                        <span>ê±´êµ­ëŒ€ ì¤‘ì•™í™˜ê²½ë™ì•„ë¦¬(CES)ì™€ í•¨ê»˜í•˜ê¸°</span>
                    </a>
                </div>
                
                <p class="text-xs text-slate-400 mt-6 border-t border-slate-100 pt-4 inline-block">
                    * ì˜ˆì¸¡ ê·¼ê±°: 2025ë…„ ì›”ê°„ ì—ë„ˆì§€ ì†Œë¹„ íŒ¨í„´ ë° 2026ë…„ ì‹¤ì¸¡ ì¦ê°ë¥  ë°˜ì˜ ëª¨ë¸
                </p>
            </div>
        </header>

        <!-- Best/Worst Section -->
        <section class="max-w-6xl mx-auto px-4 mb-12">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Best -->
                <div class="bg-gradient-to-br from-teal-50 to-white p-6 rounded-2xl border border-teal-100 shadow-sm flex items-center gap-4 relative overflow-hidden">
                    <div class="absolute -right-4 -top-4 w-20 h-20 bg-teal-100 rounded-full opacity-50"></div>
                    <div class="w-12 h-12 bg-teal-500 rounded-full flex items-center justify-center text-white text-xl z-10"><i class="fa-solid fa-trophy"></i></div>
                    <div class="z-10">
                        <span class="text-xs font-bold text-teal-600 uppercase tracking-wider">ì´ë‹¬ì˜ ì—ë„ˆì§€ ì±”í”¼ì–¸</span>
                        <h3 class="text-xl font-black text-slate-900" id="bestBuildingName">-</h3>
                        <p class="text-sm text-slate-500 mt-1" id="bestBuildingDesc">ë°ì´í„° ë¶„ì„ ì¤‘...</p>
                    </div>
                </div>
                <!-- Worst -->
                <div class="bg-gradient-to-br from-red-50 to-white p-6 rounded-2xl border border-red-100 shadow-sm flex items-center gap-4 relative overflow-hidden">
                    <div class="absolute -right-4 -top-4 w-20 h-20 bg-red-100 rounded-full opacity-50"></div>
                    <div class="w-12 h-12 bg-red-500 rounded-full flex items-center justify-center text-white text-xl z-10"><i class="fa-solid fa-triangle-exclamation"></i></div>
                    <div class="z-10">
                        <span class="text-xs font-bold text-red-600 uppercase tracking-wider">ì§‘ì¤‘ ê´€ë¦¬ ëŒ€ìƒ</span>
                        <h3 class="text-xl font-black text-slate-900" id="worstBuildingName">-</h3>
                        <p class="text-sm text-slate-500 mt-1" id="worstBuildingDesc">ë°ì´í„° ë¶„ì„ ì¤‘...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dynamic Battle Section -->
        <section id="competition" class="py-12 bg-slate-900 text-white relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-full bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-10"></div>
            <div class="max-w-6xl mx-auto px-4 relative z-10">
                <div class="text-center mb-10">
                    <h2 class="text-2xl font-bold text-yellow-400 uppercase tracking-widest mb-2"><i class="fa-solid fa-trophy mr-2"></i> Monthly Energy Battle</h2>
                    <p class="text-slate-400" id="battleMonthText">ì¶”ì²œ ë¹„êµêµ°: ê³µí•™ê´€ vs ìƒëª…ê³¼í•™ê´€</p>
                </div>
                
                <div class="flex flex-col md:flex-row gap-8 items-stretch">
                    <!-- Left Side -->
                    <div class="flex-1 bg-slate-800 rounded-2xl p-6 border-2 border-slate-700 relative flex flex-col transition-all duration-300" id="battleCardA">
                        <div class="flex justify-between items-center mb-4 gap-2">
                            <select id="battleSelectA" class="battle-select" onchange="updateBattle()"></select>
                            <span class="text-xs font-bold px-2 py-1 rounded bg-slate-700 whitespace-nowrap hidden" id="badgeA"></span>
                        </div>
                        <div class="flex items-center gap-4 mb-4">
                            <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center text-2xl" id="iconBoxA"><i class="fa-solid fa-building" id="iconA"></i></div>
                            <div>
                                <div class="text-sm text-slate-400">ì „ë…„ ëŒ€ë¹„ ì¦ê°ë¥ </div>
                                <div class="text-2xl font-bold" id="growthA">-</div>
                            </div>
                        </div>
                        <div class="w-full bg-slate-700 h-4 rounded-full overflow-hidden mb-4">
                            <div class="battle-bar-fill h-full bg-blue-500" id="barA" style="width: 50%"></div>
                        </div>
                        <div class="mt-auto pt-4 border-t border-slate-700">
                            <p class="text-xs text-slate-400 leading-relaxed" id="reasonA"></p>
                        </div>
                    </div>

                    <div class="flex items-center justify-center">
                        <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center font-black text-2xl shadow-xl border-4 border-slate-900 z-20">VS</div>
                    </div>

                    <!-- Right Side -->
                    <div class="flex-1 bg-slate-800 rounded-2xl p-6 border-2 border-teal-500 shadow-[0_0_20px_rgba(45,212,191,0.2)] relative flex flex-col transition-all duration-300" id="battleCardB">
                        <div class="flex justify-between items-center mb-4 gap-2">
                            <select id="battleSelectB" class="battle-select" onchange="updateBattle()"></select>
                            <span class="text-xs font-bold px-2 py-1 rounded bg-teal-500 text-slate-900 whitespace-nowrap" id="badgeB">WINNER ğŸ‘‘</span>
                        </div>
                        <div class="flex items-center gap-4 mb-4">
                            <div class="w-12 h-12 bg-teal-500 rounded-lg flex items-center justify-center text-2xl" id="iconBoxB"><i class="fa-solid fa-building" id="iconB"></i></div>
                            <div>
                                <div class="text-sm text-slate-400">ì „ë…„ ëŒ€ë¹„ ì¦ê°ë¥ </div>
                                <div class="text-2xl font-bold text-mint" id="growthB">-</div>
                            </div>
                        </div>
                        <div class="w-full bg-slate-700 h-4 rounded-full overflow-hidden mb-4">
                            <div class="battle-bar-fill h-full bg-mint" id="barB" style="width: 50%"></div>
                        </div>
                        <div class="mt-auto pt-4 border-t border-slate-700">
                            <p class="text-xs text-slate-400 leading-relaxed" id="reasonB"></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Building Grid -->
        <section id="solution-section" class="py-12 bg-white border-t border-slate-200">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-900">ê±´ë¬¼ë³„ ì—ë„ˆì§€ ë¦¬í¬íŠ¸</h2>
                        <p class="text-slate-500 text-sm mt-1">ì¹´ë“œë¥¼ í´ë¦­í•˜ì—¬ <span class="text-mint font-bold">ìƒì„¸ ë¶„ì„ ë° 2ì›” ì˜ˆì¸¡</span>ì„ í™•ì¸í•˜ì„¸ìš”.</p>
                    </div>
                    <div class="flex p-1 bg-slate-100 rounded-lg">
                        <button onclick="filterGrid('all')" class="filter-btn active px-4 py-2 text-sm font-medium rounded-md hover:bg-white shadow-sm transition">ì „ì²´</button>
                        <button onclick="filterGrid('study')" class="filter-btn px-4 py-2 text-sm font-medium rounded-md hover:bg-white transition">í•™ìŠµ/ì—°êµ¬</button>
                        <button onclick="filterGrid('living')" class="filter-btn px-4 py-2 text-sm font-medium rounded-md hover:bg-white transition">ìƒí™œ/í¸ì˜</button>
                        <button onclick="filterGrid('admin')" class="filter-btn px-4 py-2 text-sm font-medium rounded-md hover:bg-white transition">í–‰ì •/ê¸°íƒ€</button>
                    </div>
                </div>
                <div id="buildingsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </div>
        </section>

        <!-- AI Consultant -->
        <section class="py-16 bg-slate-900 text-white border-t border-slate-800">
            <div class="max-w-4xl mx-auto px-4 text-center">
                <div class="inline-block bg-teal-500/20 text-teal-300 text-xs font-bold px-3 py-1 rounded-full mb-4 border border-teal-500/50">AI Beta</div>
                <h2 class="text-3xl font-bold mb-4">AI ì—ë„ˆì§€ ì»¨ì„¤í„´íŠ¸</h2>
                <p class="text-slate-400 mb-8">ê±´ë¬¼ì„ ì„ íƒí•˜ë©´ Geminiê°€ ê±´ë¬¼ íŠ¹ì„±ì— ë§ëŠ” ë„›ì§€ ìº í˜ì¸ì„ ì œì•ˆí•©ë‹ˆë‹¤.</p>
                <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700 max-w-2xl mx-auto">
                    <div class="flex gap-4 mb-6">
                        <select id="aiBuildingSelect" class="flex-1 bg-slate-700 border-none rounded-lg text-white px-4 py-3 focus:ring-2 focus:ring-teal-500"></select>
                        <button onclick="generateAIStrategy()" id="aiBtn" class="bg-teal-600 hover:bg-teal-500 text-white px-6 py-3 rounded-lg font-bold transition flex items-center gap-2">
                            <span>ì „ëµ ìƒì„±</span> <i class="fa-solid fa-wand-magic-sparkles"></i>
                        </button>
                    </div>
                    <div id="aiOutput" class="hidden text-left bg-slate-900 p-6 rounded-xl border border-slate-700">
                        <div class="flex gap-4">
                            <div class="w-10 h-10 rounded-full bg-teal-500/20 flex items-center justify-center flex-shrink-0"><i class="fa-solid fa-lightbulb text-teal-400"></i></div>
                            <div class="flex-grow space-y-3">
                                <p id="aiNudgeText" class="text-slate-300 text-sm leading-relaxed mt-1">...</p>
                                <div class="border-t border-slate-800 pt-3">
                                    <p id="aiSloganText" class="text-white text-lg mt-1 font-slogan text-mint">"..."</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="aiLoading" class="hidden py-8"><i class="fa-solid fa-circle-notch fa-spin text-2xl text-teal-500"></i></div>
                </div>
            </div>
        </section>
    </main>

    <!-- ================= PAGE 2: CAMPAIGN ================= -->
    <main id="page-campaign" class="hidden-page">
        <header class="py-20 bg-slate-900 text-white text-center overflow-hidden relative">
            <div class="absolute top-0 left-0 w-full h-full bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-10"></div>
            <div class="max-w-3xl mx-auto px-4 relative z-10">
                <i class="fa-solid fa-coins text-6xl text-yellow-400 mb-6 animate-bounce"></i>
                <h1 class="text-4xl md:text-5xl font-black mb-6">ì½”ì¸ ì§€ê¸‰ ìº í˜ì¸ í™œë™</h1>
                <p class="text-lg text-slate-300 leading-relaxed">ì—ë„ˆì§€ë¥¼ ì•„ë¼ëŠ” ì‘ì€ ìŠµê´€ì´ ê°€ì¹˜ ìˆëŠ” ë³´ìƒìœ¼ë¡œ ëŒì•„ì˜µë‹ˆë‹¤.</p>
                <div class="mt-8 flex justify-center gap-4">
                    <button onclick="openApplyModal()" class="bg-gradient-to-r from-yellow-400 to-orange-500 text-slate-900 font-black px-8 py-4 rounded-full shadow-lg hover:scale-105 transition transform flex items-center gap-2">
                        <i class="fa-solid fa-paper-plane"></i> ì§€ê¸ˆ ë°”ë¡œ ìº í˜ì¸ ì°¸ì—¬í•˜ê¸°
                    </button>
                    <button onclick="openCancelModal()" class="bg-white text-slate-700 font-bold px-8 py-4 rounded-full shadow-lg hover:bg-slate-100 transition transform border border-slate-200">
                        <i class="fa-solid fa-trash"></i> ì°¸ì—¬ ì·¨ì†Œí•˜ê¸°
                    </button>
                </div>
            </div>
        </header>

        <section class="py-16 bg-white">
            <div class="max-w-5xl mx-auto px-4">
                <div class="text-center mb-12">
                    <span class="text-mint font-bold text-sm uppercase tracking-wider">How It Works</span>
                    <h2 class="text-3xl font-bold text-slate-900">ì½”ì¸ ì§€ê¸‰ ìº í˜ì¸ í™œë™ ë©”ë‰´ì–¼</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                    <div class="text-center group">
                        <div class="w-20 h-20 bg-teal-100 rounded-full flex items-center justify-center text-3xl text-teal-600 mx-auto mb-4 group-hover:bg-teal-200 transition shadow-sm">
                            <i class="fa-solid fa-building-circle-check"></i>
                        </div>
                        <h3 class="font-bold mb-2">1. ê´€ì‹¬ ê±´ë¬¼ ì„ ì •</h3>
                        <p class="text-xs text-slate-500">ì£¼ìš” í™œë™ ê±´ë¬¼ ì„ íƒ</p>
                    </div>
                    <div class="text-center group">
                        <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center text-3xl text-blue-600 mx-auto mb-4 group-hover:bg-blue-200 transition shadow-sm">
                            <i class="fa-solid fa-lightbulb"></i>
                        </div>
                        <h3 class="font-bold mb-2">2. ì ˆê° ìº í˜ì¸ ì§„í–‰</h3>
                        <p class="text-xs text-slate-500">ë§ì¶¤í˜• ë„›ì§€ ì•¡ì…˜ ì‹¤ì²œ</p>
                    </div>
                    <div class="text-center group">
                        <div class="w-20 h-20 bg-yellow-100 rounded-full flex items-center justify-center text-3xl text-yellow-600 mx-auto mb-4 group-hover:bg-yellow-200 transition shadow-sm">
                            <!-- Quantitative Measurement Illustration -->
                            <i class="fa-solid fa-chart-pie bounce-slow"></i>
                        </div>
                        <h3 class="font-bold mb-2">3. ì •ëŸ‰ì  ì„±ê³¼ ì¸¡ì •</h3>
                        <p class="text-xs text-slate-500">ë°ì´í„° ê¸°ë°˜ ì ˆê°ëŸ‰ í™•ì¸</p>
                    </div>
                    <div class="text-center group">
                        <div class="w-20 h-20 bg-purple-100 rounded-full flex items-center justify-center text-3xl text-purple-600 mx-auto mb-4 group-hover:bg-purple-200 transition shadow-sm">
                            <i class="fa-solid fa-gift"></i>
                        </div>
                        <h3 class="font-bold mb-2">4. ë³´ìƒ ì§€ê¸‰ ë° ì„ íƒ</h3>
                        <p class="text-xs text-slate-500">ì½”ì¸ ê¸°ë°˜ ë¦¬ì›Œë“œ êµí™˜</p>
                    </div>
                </div>

                <div class="mt-20 max-w-4xl mx-auto bg-slate-50 rounded-2xl p-10 border border-slate-200 shadow-inner text-center">
                    <h3 class="text-2xl font-bold mb-8">ğŸ’° ì›”ê°„ ì½”ì¸ ì§€ê¸‰ ì •ì±… (ì´ 150ì½”ì¸ í•œë„)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-xl border-2 border-yellow-400 shadow-md">
                            <i class="fa-solid fa-crown text-3xl text-yellow-500 mb-2"></i>
                            <h4 class="font-bold">1ìœ„íŒ€ (1íŒ€)</h4>
                            <p class="text-3xl font-black gradient-coin mt-2">50 ì½”ì¸</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                            <i class="fa-solid fa-medal text-3xl text-slate-300 mb-2"></i>
                            <h4 class="font-bold">2ìœ„íŒ€ (2íŒ€)</h4>
                            <p class="text-2xl font-black text-slate-700 mt-2">30 ì½”ì¸</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                            <i class="fa-solid fa-award text-3xl text-amber-600 mb-2"></i>
                            <h4 class="font-bold">3ìœ„íŒ€ (4íŒ€)</h4>
                            <p class="text-2xl font-black text-slate-700 mt-2">10 ì½”ì¸</p>
                        </div>
                    </div>
                    <p class="mt-8 text-sm text-slate-500">* 1ì½”ì¸ ë‹¹ ì»¤í”¼ ì¿ í° 1ë§¤ í˜¹ì€ ëŒ€í•™ ë°œì „ ê¸°ê¸ˆ ê¸°ë¶€ ì„ íƒê¶Œ ë¶€ì—¬</p>
                </div>
            </div>
        </section>
    </main>

    <!-- ================= FOOTER ================= -->
    <footer class="bg-white border-t border-slate-200 py-16 text-center relative z-20">
        <div class="max-w-4xl mx-auto px-4 space-y-6">
            <div class="flex items-center justify-center gap-2">
                <!-- Clean Mint Logo -->
                <div class="w-10 h-10 flex items-center justify-center">
                    <i class="fa-solid fa-bolt text-3xl text-mint drop-shadow-sm"></i>
                </div>
                <h2 class="text-2xl font-black text-slate-900">En-Pocket</h2>
            </div>
            
            <p class="text-slate-500 font-medium italic">ì§€ì† ê°€ëŠ¥í•œ ìº í¼ìŠ¤ë¥¼ ìœ„í•œ ì‘ì€ ì›€ì§ì„</p>
            <div class="w-12 h-1 bg-mint mx-auto rounded-full"></div>
            <div class="text-sm text-slate-500 leading-relaxed font-medium">
                <p>Representative: Lee Jeong-hoon | Project Period: 2025.07 - 2025.11</p>
                <p>Data Source: Campus Facility Management Team (Jan 2025-2026)</p>
                <p class="mt-4 text-xs">í™œë™ ë° ìº í˜ì¸ ë¬¸ì˜: <span class="text-ku font-bold">010-3728-4610</span> (ì´ì •í›ˆ ëŒ€í‘œ)</p>
                <p class="mt-2 text-xs text-slate-400">í•´ë‹¹ ìë£ŒëŠ” ê±´êµ­ëŒ€í•™êµ ì‹œì„¤íŒ€ìœ¼ë¡œë¶€í„° ì œê³µë°›ì€ ìë£Œë¥¼ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.</p>
            </div>
            
            <p class="text-xs text-slate-400 border-t border-slate-100 inline-block pt-4">
                â€» ì•„ë©”ë¦¬ì¹´ë…¸ í™˜ì‚° ê¸°ì¤€: 2,000ì› (êµë‚´ ë° ì¸ê·¼ ì¹´í˜ í‰ê· ê°€ ì ìš©)
            </p>
            
            <div class="pt-6 flex justify-center gap-4">
                <!-- Fixed Admin Buttons -->
                <button onclick="adminLogin()" class="text-slate-300 hover:text-slate-500 transition p-4 rounded-full hover:bg-slate-50 relative z-50 focus:outline-none cursor-pointer" title="ê´€ë¦¬ì ì „ìš©">
                    <i class="fa-solid fa-lock text-xl"></i>
                </button>
                <button onclick="viewApplicants()" class="text-slate-300 hover:text-slate-500 transition p-4 rounded-full hover:bg-slate-50 relative z-50 focus:outline-none cursor-pointer" title="ì‹ ì²­ì ëª…ë‹¨">
                    <i class="fa-solid fa-list-check text-xl"></i>
                </button>
            </div>
        </div>
    </footer>

    <!-- Hidden Input for Data Update -->
    <input type="file" id="excelInput" accept=".xlsx, .csv" class="hidden" onchange="handleFileUpload(event)">

    <!-- Detail Modal -->
    <div id="detailModal" class="modal fixed inset-0 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onclick="closeModal()">
        <div class="modal-content bg-white w-full max-w-3xl rounded-2xl shadow-2xl overflow-hidden" onclick="event.stopPropagation()">
            <div class="bg-slate-50 px-6 py-4 border-b border-slate-200 flex justify-between items-center">
                <h3 id="modalTitle" class="text-lg font-bold">ê±´ë¬¼ ìƒì„¸ ë¶„ì„</h3>
                <button onclick="closeModal()" class="text-slate-400 hover:text-slate-600"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div class="flex border-b border-slate-200">
                <button onclick="switchTab('short')" id="tabShort" class="tab-btn active flex-1 py-3 text-center transition-colors">ğŸ“Š 2ì›” ì˜ˆì¸¡ & ì¶”ì´</button>
                <button onclick="switchTab('long')" id="tabLong" class="tab-btn flex-1 py-3 text-center transition-colors">ğŸ“… 2025 ì—°ê°„ íŒ¨í„´</button>
            </div>
            <div class="p-6">
                <div id="contentShort" class="block">
                    <div class="h-64 w-full mb-6"><canvas id="chartShort"></canvas></div>
                    <div class="bg-blue-50 p-4 rounded-xl border border-blue-100 text-sm leading-relaxed" id="modalPredictionShort"></div>
                </div>
                <div id="contentLong" class="hidden">
                    <div class="h-64 w-full mb-6"><canvas id="chartLong"></canvas></div>
                    <div class="bg-indigo-50 p-4 rounded-xl border border-indigo-100 text-sm leading-relaxed" id="modalAnalysisLong"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Apply Modal -->
    <div id="applyModal" class="modal fixed inset-0 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" style="z-index: 200;">
        <div class="modal-content bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden p-6 relative">
            <button onclick="closeApplyModal()" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600"><i class="fa-solid fa-xmark text-xl"></i></button>
            <h3 class="text-xl font-bold mb-4 text-slate-900">ìº í˜ì¸ ì°¸ì—¬ ì‹ ì²­ì„œ</h3>
            <form onsubmit="submitApplication(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-bold text-slate-700 mb-1">í¬ë§ ê±´ë¬¼ (1íŒ€ 1ê±´ë¬¼ ì›ì¹™)</label>
                    <select id="appBuilding" required class="w-full border border-slate-300 rounded-lg p-2 text-sm bg-white"></select>
                </div>
                <div><label class="block text-sm font-bold text-slate-700 mb-1">ëŒ€í‘œì ì´ë¦„</label><input type="text" id="appName" required class="w-full border border-slate-300 rounded-lg p-2 text-sm"></div>
                <div><label class="block text-sm font-bold text-slate-700 mb-1">í•™ê³¼</label><input type="text" id="appMajor" required class="w-full border border-slate-300 rounded-lg p-2 text-sm"></div>
                <div><label class="block text-sm font-bold text-slate-700 mb-1">í•™ë²ˆ</label><input type="text" id="appId" required class="w-full border border-slate-300 rounded-lg p-2 text-sm"></div>
                <div><label class="block text-sm font-bold text-slate-700 mb-1">íŒ€ì› ìˆ˜</label><input type="number" id="appTeamSize" required class="w-full border border-slate-300 rounded-lg p-2 text-sm"></div>
                <div><label class="block text-sm font-bold text-slate-700 mb-1">ì „í™”ë²ˆí˜¸</label><input type="tel" id="appPhone" required class="w-full border border-slate-300 rounded-lg p-2 text-sm"></div>
                <button type="submit" class="w-full bg-teal-600 text-white font-bold py-3 rounded-lg hover:bg-teal-700 transition">ì œì¶œí•˜ê¸°</button>
            </form>
        </div>
    </div>

    <!-- Cancel Modal -->
    <div id="cancelModal" class="modal fixed inset-0 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" style="z-index: 200;">
        <div class="modal-content bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden p-6 relative">
            <button onclick="closeCancelModal()" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600"><i class="fa-solid fa-xmark text-xl"></i></button>
            <h3 class="text-xl font-bold mb-4 text-red-600">ìº í˜ì¸ ì°¸ì—¬ ì·¨ì†Œ</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-bold text-slate-700 mb-1">ì·¨ì†Œí•  ê±´ë¬¼ ì„ íƒ</label>
                    <select id="cancelBuilding" class="w-full border border-slate-300 rounded-lg p-2 text-sm bg-white"></select>
                </div>
                <div>
                    <label class="block text-sm font-bold text-slate-700 mb-1">ëŒ€í‘œì ì´ë¦„</label>
                    <input type="text" id="cancelName" required class="w-full border border-slate-300 rounded-lg p-2 text-sm">
                </div>
                <p class="text-xs text-slate-500">* ì‹ ì²­ ì‹œ ì…ë ¥í•œ ëŒ€í‘œì ì´ë¦„ê³¼ ì¼ì¹˜í•´ì•¼ ì·¨ì†Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                <button onclick="submitCancel()" class="w-full bg-red-500 text-white font-bold py-3 rounded-lg hover:bg-red-600 transition">ì‹ ì²­ ì·¨ì†Œí•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- ================= JAVASCRIPT ================= -->
    <script>
        // --- Global State ---
        let applicants = [];
        let currentMonthIndex = 0;
        let displayMonth = "1ì›”";
        let nextMonth = "2ì›”";
        let currentBuilding = null; 

        // --- Data Logic (Full 28 Filtered Buildings) ---
        // Generating annual pattern based on 2025 Jan data
        function generateAnnualData(janValue, cat) {
            let ratios = cat==='living' ? [1.0,0.95,0.85,0.75,0.70,0.80,1.1,1.15,0.85,0.75,0.9,0.98] :
                         cat==='study'  ? [1.0,0.90,1.10,1.05,1.00,1.15,1.25,1.15,1.05,1.00,1.05,0.95] :
                                          [1.0,0.95,0.90,0.85,0.85,0.95,1.10,1.10,0.90,0.85,0.90,0.95];
            return ratios.map(r => Math.floor(janValue * r));
        }

        // Updated Data based on user request (Exact List, No 2024, Correct Eng Rate)
        // Fixed: Growth Rate is preserved, Value is preserved
        const buildingList = [
            {n:"êµìœ¡ê³¼í•™ê´€", c:"study", u:20600, g:10.8, d:"í•™ìŠµ/ì—°êµ¬", s:"ë¹ˆ ê°•ì˜ì‹¤ ì†Œë“±"},
            {n:"ê³µí•™ê´€", c:"study", u:235790, g:14.6, d:"í•™ìŠµ/ì—°êµ¬", s:"ë¹ˆ ê°•ì˜ì‹¤ ì†Œë“±"},
            {n:"ì¸ë¬¸í•™ê´€", c:"study", u:26380, g:2.1, d:"í•™ìŠµ/ì—°êµ¬", s:"ë¹ˆ ê°•ì˜ì‹¤ ì†Œë“±"},
            {n:"ì–¸ì–´êµìœ¡ì›", c:"study", u:15690, g:-0.4, d:"í•™ìŠµ/ì—°êµ¬", s:"ë¹ˆ ê°•ì˜ì‹¤ ì†Œë“±"},
            {n:"ì°½ì˜ê´€", c:"study", u:28400, g:2.0, d:"í•™ìŠµ/ì—°êµ¬", s:"ë¹ˆ ê°•ì˜ì‹¤ ì†Œë“±"},
            {n:"ì…í•™ì •ë³´ê´€", c:"admin", u:135200, g:12.9, d:"í–‰ì •/ì§€ì›", s:"ëŒ€ê¸°ì „ë ¥ ì°¨ë‹¨"},
            {n:"ì‹¤ë‚´ì²´ìœ¡ê´€", c:"study", u:8960, g:0.9, d:"í•™ìŠµ/ì—°êµ¬", s:"ë¹ˆ ê°•ì˜ì‹¤ ì†Œë“±"},
            {n:"ê±´ì¶•ê´€", c:"study", u:31330, g:11.6, d:"í•™ìŠµ/ì—°êµ¬", s:"ë¹ˆ ê°•ì˜ì‹¤ ì†Œë“±"},
            {n:"í–‰ì •ê´€", c:"admin", u:68260, g:13.8, d:"í–‰ì •/ì§€ì›", s:"ëŒ€ê¸°ì „ë ¥ ì°¨ë‹¨"},
            {n:"ì¼ìš°í—Œ", c:"living", u:7090, g:14.7, d:"ê±°ì£¼ ì‹œì„¤", s:"ê°œë³„ ì „ì—´ê¸°êµ¬ ê´€ë¦¬"},
            {n:"í•™ìƒíšŒê´€", c:"study", u:63950, g:8.8, d:"í•™ìŠµ/ì—°êµ¬", s:"ë¹ˆ ê°•ì˜ì‹¤ ì†Œë“±"},
            {n:"ë²•í•™ì „ë¬¸ëŒ€í•™ì›", c:"study", u:48760, g:6.9, d:"í•™ìŠµ/ì—°êµ¬", s:"ë¹ˆ ê°•ì˜ì‹¤ ì†Œë“±"},
            {n:"ê²½ì˜ê´€", c:"study", u:55400, g:9.9, d:"í•™ìŠµ/ì—°êµ¬", s:"ë¹ˆ ê°•ì˜ì‹¤ ì†Œë“±"},
            {n:"ìƒí—ˆê¸°ë…ë„ì„œê´€", c:"study", u:179500, g:16.0, d:"í•™ìŠµ/ì—°êµ¬", s:"ë¹ˆ ê°•ì˜ì‹¤ ì†Œë“±"},
            {n:"ê³µì˜ˆê´€", c:"study", u:17860, g:7.3, d:"í•™ìŠµ/ì—°êµ¬", s:"ë¹ˆ ê°•ì˜ì‹¤ ì†Œë“±"},
            {n:"ê³¼í•™ê´€", c:"study", u:124300, g:9.6, d:"í•™ìŠµ/ì—°êµ¬", s:"ë¹ˆ ê°•ì˜ì‹¤ ì†Œë“±"},
            {n:"ìƒˆì²œë…„ê´€", c:"admin", u:155580, g:10.3, d:"í–‰ì •/ì§€ì›", s:"ëŒ€ê¸°ì „ë ¥ ì°¨ë‹¨"},
            {n:"ìˆ˜ì˜í•™ê´€", c:"study", u:122000, g:22.8, d:"í•™ìŠµ/ì—°êµ¬", s:"ë¹ˆ ê°•ì˜ì‹¤ ì†Œë“±"},
            {n:"KUê¸°ìˆ í˜ì‹ ê´€", c:"admin", u:39600, g:10.0, d:"í–‰ì •/ì§€ì›", s:"ëŒ€ê¸°ì „ë ¥ ì°¨ë‹¨"},
            {n:"ìƒëª…ê³¼í•™ê´€", c:"study", u:139100, g:14.5, d:"í•™ìŠµ/ì—°êµ¬", s:"ë¹ˆ ê°•ì˜ì‹¤ ì†Œë“±"},
            {n:"ì‚°í•™í˜‘ë™ê´€", c:"admin", u:154330, g:26.3, d:"í–‰ì •/ì§€ì›", s:"ëŒ€ê¸°ì „ë ¥ ì°¨ë‹¨"},
            {n:"ìƒí—ˆì—°êµ¬ê´€", c:"study", u:51200, g:9.4, d:"í•™ìŠµ/ì—°êµ¬", s:"ë¹ˆ ê°•ì˜ì‹¤ ì†Œë“±"},
            {n:"KULHOUSE", c:"living", u:782041, g:13.0, d:"ê±°ì£¼ ì‹œì„¤", s:"ê°œë³„ ì „ì—´ê¸°êµ¬ ê´€ë¦¬"},
            {n:"ì˜ˆìˆ ë””ìì¸ëŒ€í•™", c:"study", u:65408, g:9.0, d:"í•™ìŠµ/ì—°êµ¬", s:"ë¹ˆ ê°•ì˜ì‹¤ ì†Œë“±"},
            {n:"ì˜í•™ìƒëª…ê³¼í•™ê´€", c:"study", u:186516, g:-13.3, d:"í•™ìŠµ/ì—°êµ¬", s:"ë¹ˆ ê°•ì˜ì‹¤ ì†Œë“±"},
            {n:"ë™ë¬¼ìƒëª…ê³¼í•™ê´€", c:"study", u:112800, g:9.3, d:"í•™ìŠµ/ì—°êµ¬", s:"ë¹ˆ ê°•ì˜ì‹¤ ì†Œë“±"},
            {n:"ë¶€ë™ì‚°í•™ê´€", c:"study", u:24720, g:8.4, d:"í•™ìŠµ/ì—°êµ¬", s:"ë¹ˆ ê°•ì˜ì‹¤ ì†Œë“±"},
            {n:"ì‹ ê³µí•™ê´€", c:"study", u:328000, g:18.8, d:"í•™ìŠµ/ì—°êµ¬", s:"ë¹ˆ ê°•ì˜ì‹¤ ì†Œë“±"}
        ];

        let buildingDB = buildingList.map(b => {
            // b.u = 2026 Jan Real
            // b.g = Growth (Fixed from data)
            // 2025 Jan = b.u / (1 + b.g/100)
            let u25 = Math.floor(b.u / (1 + b.g/100));
            
            return {
                ...b,
                name: b.n, cat: b.c, desc: b.d, solution: b.s,
                u26_jan: b.u,
                u25_jan: u25,
                growth: b.g, // Locked
                // Generate 2025 annual history starting from u25
                history25: generateAnnualData(u25, b.c),
                winFactor: "ì ê·¹ì ì¸ " + b.s + " ìº í˜ì¸ ì‹¤ì²œ",
                loseFactor: "ì „ë…„ ëŒ€ë¹„ ì‚¬ìš©ëŸ‰ ì¦ê°€, " + b.s + " í•„ìš”"
            };
        });

        // --- Init ---
        document.addEventListener('DOMContentLoaded', () => {
            initBattleDropdowns();
            populateDropdown();
            populateAISelect();
            updateBestWorst();
            refreshDashboard();
            switchPage('dashboard');
            
            // Populate Dropdowns
            const appBuildingSelect = document.getElementById('appBuilding');
            const cancelBuildingSelect = document.getElementById('cancelBuilding');
            
            buildingDB.forEach(b => {
                const opt = document.createElement('option');
                opt.value = b.name;
                opt.text = b.name;
                appBuildingSelect.appendChild(opt);
                cancelBuildingSelect.appendChild(opt.cloneNode(true));
            });
        });

        // --- Core Functions ---
        function switchPage(p) {
            document.getElementById('page-dashboard').classList.toggle('hidden-page', p!=='dashboard');
            document.getElementById('page-campaign').classList.toggle('hidden-page', p!=='campaign');
            document.getElementById('nav-dashboard-links').classList.toggle('hidden', p!=='dashboard');
            document.getElementById('nav-campaign-links').classList.toggle('hidden', p!=='campaign');
            document.getElementById('nav-dashboard-menu').classList.toggle('hidden', p!=='dashboard');
            if(window.innerWidth >= 768 && p==='dashboard') document.getElementById('nav-dashboard-menu').classList.add('md:flex');
            window.scrollTo(0,0);
        }

        function refreshDashboard() {
            renderGrid(buildingDB);
            updateBattle();
            updateBestWorst();
            document.getElementById('currentMonthDisplay').innerText = displayMonth;
        }

        function updateBestWorst() {
            const sorted = [...buildingDB].sort((a,b)=>a.growth - b.growth);
            const best = sorted[0];
            const worst = sorted[sorted.length-1];
            
            if(document.getElementById('bestBuildingName')) {
                document.getElementById('bestBuildingName').innerText = best.name;
                document.getElementById('bestBuildingDesc').innerText = `${displayMonth} ì¦ê°ë¥  ${best.growth}% (ìµœì €)`;
                document.getElementById('worstBuildingName').innerText = worst.name;
                document.getElementById('worstBuildingDesc').innerText = `${displayMonth} ì¦ê°ë¥  +${worst.growth}% (ìµœê³ )`;
            }
        }

        // --- Battle Logic ---
        function initBattleDropdowns() {
            const sA = document.getElementById('battleSelectA');
            const sB = document.getElementById('battleSelectB');
            if(!sA || !sB) return;
            sA.innerHTML=''; sB.innerHTML='';
            buildingDB.forEach((b,i)=>{
                sA.add(new Option(b.name, i)); sB.add(new Option(b.name, i));
            });
            const engIdx = buildingDB.findIndex(b=>b.name.includes("ê³µí•™ê´€"));
            const bioIdx = buildingDB.findIndex(b=>b.name.includes("ìƒëª…ê³¼í•™ê´€"));
            sA.value = engIdx >= 0 ? engIdx : 0;
            sB.value = bioIdx >= 0 ? bioIdx : 1;
        }

        function updateBattle() {
            const idxA = document.getElementById('battleSelectA').value;
            const idxB = document.getElementById('battleSelectB').value;
            if (idxA === "" || idxB === "") return;
            renderBattleSide('A', buildingDB[idxA], buildingDB[idxB]);
            renderBattleSide('B', buildingDB[idxB], buildingDB[idxA]);
        }

        function renderBattleSide(side, bSelf, bOpponent) {
            const growthSelf = parseFloat(bSelf.growth);
            const growthOpp = parseFloat(bOpponent.growth);
            const isWin = growthSelf < growthOpp;
            
            document.getElementById(`icon${side}`).className = `fa-solid ${getIcon(bSelf.name)}`;
            const growthElem = document.getElementById(`growth${side}`);
            growthElem.innerText = `${growthSelf > 0 ? '+' : ''}${growthSelf}%`;
            growthElem.className = `text-2xl font-bold ${isWin ? 'text-mint' : 'text-red-400'}`;
            
            document.getElementById(`bar${side}`).style.width = isWin ? '70%' : '30%';
            document.getElementById(`bar${side}`).className = `battle-bar-fill h-full ${isWin ? 'bg-mint' : 'bg-blue-500'}`;
            
            const badge = document.getElementById(`badge${side}`);
            if(badge) {
                badge.style.display = isWin ? "inline-block" : "none";
                badge.innerText = isWin ? "WINNER ğŸ‘‘" : "";
            }
            
            document.getElementById(`battleCard${side}`).className = `flex-1 bg-slate-800 rounded-2xl p-6 border-2 flex flex-col transition-all duration-300 ${isWin ? 'border-teal-500 shadow-[0_0_20px_rgba(45,212,191,0.2)]' : 'border-slate-700'}`;
            document.getElementById(`iconBox${side}`).className = `w-12 h-12 rounded-lg flex items-center justify-center text-2xl transition-colors duration-300 ${isWin ? 'bg-mint text-slate-900' : 'bg-blue-600'}`;
            document.getElementById(`reason${side}`).innerHTML = isWin ? `<span class="font-bold text-mint mb-1 block">ìŠ¹ë¦¬ ìš”ì¸:</span>${bSelf.winFactor}` : `<span class="font-bold text-blue-400 mb-1 block">íŒ¨ë°° ì›ì¸:</span>${bSelf.loseFactor}`;
        }

        // --- Grid Render ---
        function renderGrid(data) {
            const grid = document.getElementById('buildingsGrid');
            grid.innerHTML = '';
            data.forEach((b) => {
                const increase = b.u26_jan - b.u25_jan;
                // Safe check for toLocaleString and NaN
                const u25_val = b.u25_jan || 0;
                const u26_val = b.u26_jan || 0;
                
                const coffeeCups = Math.max(0, Math.floor(((u26_val - u25_val)*120)/2000));
                const co2 = Math.max(0, (increase * 0.424).toFixed(1));
                
                const div = document.createElement('div');
                div.className = "bg-white rounded-2xl p-6 border border-slate-200 shadow-sm card-hover flex flex-col cursor-pointer group";
                // Only card click opens modal
                div.onclick = () => openModal(b.name);
                div.dataset.id = b.name; 
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 group-hover:bg-mint group-hover:text-white transition"><i class="fa-solid ${getIcon(b.name)}"></i></div>
                            <div><h3 class="font-bold text-slate-900 group-hover:text-mint transition">${b.name}</h3><span class="text-xs text-slate-400 font-medium uppercase">${b.cat}</span></div>
                        </div>
                        <div class="text-lg font-bold ${b.growth>0?'text-red-500':'text-emerald-500'}">${b.growth>0?'+':''}${b.growth}%</div>
                    </div>
                    <div class="bg-slate-50 rounded-lg p-3 mb-4 text-sm font-sans">
                        <div class="flex justify-between"><span>25ë…„ ${displayMonth}</span><span class="font-bold text-slate-600 font-sans">${u25_val.toLocaleString()}</span></div>
                        <div class="flex justify-between text-mint mt-1"><span>26ë…„ ${displayMonth}</span><span class="font-bold font-sans">${u26_val.toLocaleString()}</span></div>
                    </div>
                    <div class="mb-4 bg-orange-50 p-3 rounded-lg border border-orange-100 text-xs text-orange-800 leading-tight flex flex-col gap-1" onclick="openModal('${b.name}')">
                        <div class="flex items-center gap-2 font-bold"><i class="fa-solid fa-mug-hot"></i> ì¦ê°€ë¶„ = ì•„ë©”ë¦¬ì¹´ë…¸ ${coffeeCups.toLocaleString()}ì” ê°’!</div>
                        <div class="flex items-center gap-2 text-slate-500"><i class="fa-solid fa-cloud"></i> íƒ„ì†Œ ì¦ê°€: ${co2} kg-CO2</div>
                    </div>
                    <div class="mt-auto pt-4 border-t border-slate-100 flex justify-between items-center">
                        <span class="text-xs text-slate-400 font-medium group-hover:text-mint transition" onclick="openModal('${b.name}')">ìƒì„¸ ë¶„ì„ &rarr;</span>
                        <button onclick="goToCampaign(event, '${b.name}')" class="text-xs bg-mint text-white px-3 py-1 rounded-full font-bold hover:bg-teal-600 transition">âš¡ ì½”ì¸ ìº í˜ì¸ ì°¸ì—¬</button>
                    </div>
                `;
                grid.appendChild(div);
            });
        }
        
        function goToCampaign(e, buildingName) {
            e.stopPropagation(); // Prevent modal opening
            switchPage('campaign');
            openApplyModal(buildingName);
        }

        // --- AI ---
        async function generateAIStrategy() {
            const b = buildingDB[document.getElementById('aiBuildingSelect').value];
            document.getElementById('aiLoading').classList.remove('hidden');
            document.getElementById('aiOutput').classList.add('hidden');
            
            const slogans = [
                "ì‘ì€ ì‹¤ì²œì´ ë§Œë“œëŠ” í° ë³€í™”, En-Pocket!",
                "ì§€êµ¬ë¥¼ ìœ„í•œ 1ë¶„, ì§€ê¸ˆ ìŠ¤ìœ„ì¹˜ë¥¼ ë‚´ë ¤ì£¼ì„¸ìš”.",
                "ì˜¤ëŠ˜ì˜ ì†Œë“±ì´ ë‚´ì¼ì˜ ë§‘ì€ ê³µê¸°ë¥¼ ë§Œë“­ë‹ˆë‹¤.",
                "ë‹¹ì‹ ì˜ ì ˆì•½ì´ ê±´êµ­ëŒ€ì˜ ë…¹ìƒ‰ ë¯¸ë˜ì…ë‹ˆë‹¤.",
                "ì—ë„ˆì§€ ë‹¤ì´ì–´íŠ¸, ë‚˜ë¶€í„° ì‹œì‘í•©ë‹ˆë‹¤."
            ];
            
            // Randomized strategies
            const strategies = [
                `${b.solution} ìº í˜ì¸ê³¼ í•¨ê»˜ CES ì£¼ê´€ 'ë¹ˆ ê°•ì˜ì‹¤ ì†Œë“± ë¦´ë ˆì´'ì— ì°¸ì—¬í•´ë³´ì„¸ìš”!`,
                `${b.solution} ì‹¤ì²œìœ¼ë¡œ ëŒ€ê¸°ì „ë ¥ì„ ì°¨ë‹¨í•˜ê³  íƒ„ì†Œ ë°œìêµ­ì„ ì¤„ì—¬ë³´ì„¸ìš”.`,
                `ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í”ŒëŸ¬ê·¸ ë½‘ê¸°, ${b.name}ì˜ ì—ë„ˆì§€ ì§€í‚´ì´ê°€ ë˜ì–´ì£¼ì„¸ìš”.`,
                `${b.solution} í™œë™ì„ ì¸ì¦í•˜ê³  En-Pocket ì½”ì¸ì„ ë°›ì•„ê°€ì„¸ìš”!`
            ];
            
            setTimeout(() => {
                const sl = slogans[Math.floor(Math.random()*slogans.length)];
                const st = strategies[Math.floor(Math.random()*strategies.length)];
                
                document.getElementById('aiNudgeText').innerText = `[${b.name} ë§ì¶¤ ì „ëµ] ${st}`;
                document.getElementById('aiSloganText').innerText = `"${sl}"`;
                document.getElementById('aiLoading').classList.add('hidden');
                document.getElementById('aiOutput').classList.remove('hidden');
            }, 1000);
        }

        // --- Modal & Charts ---
        let chartInstance = null;
        let selectedB = null;
        
        function openModal(name) {
            selectedB = buildingDB.find(b => b.name === name);
            if(!selectedB) return;
            document.getElementById('modalTitle').innerText = `${name} ìƒì„¸ ë¶„ì„`;
            document.getElementById('detailModal').classList.add('active');
            switchTab('short');
        }
        function closeModal() { document.getElementById('detailModal').classList.remove('active'); }
        function switchTab(t) {
            const isShort = t==='short';
            document.getElementById('tabShort').classList.toggle('active', isShort);
            document.getElementById('tabLong').classList.toggle('active', !isShort);
            document.getElementById('contentShort').style.display = isShort?'block':'none';
            document.getElementById('contentLong').style.display = isShort?'none':'block';
            
            const ctx = document.getElementById(isShort?'chartShort':'chartLong').getContext('2d');
            if(chartInstance) chartInstance.destroy();
            
            if(isShort) {
                // Short Term: 25 Jan, 26 Jan, 25 Feb, 26 Feb(Pred)
                const jan25 = selectedB.u25_jan;
                const jan26 = selectedB.u26_jan;
                
                // Feb Data (Simulated based on history)
                const feb25 = selectedB.history25[1];
                
                // Prediction Logic for Feb 26: 25_Feb * (1 + growth/100)
                // Using fixed growth rate (g) for prediction
                const growthRate = selectedB.growth / 100;
                const predFeb26 = Math.floor((feb25 || 0) * (1 + growthRate)) || 0;

                chartInstance = new Chart(ctx, { type:'bar', data:{
                    labels: ['25ë…„ 1ì›”', '26ë…„ 1ì›”', '25ë…„ 2ì›”', '26ë…„ 2ì›”(ì˜ˆ)'],
                    datasets:[{
                        label:'ì „ë ¥ ì‚¬ìš©ëŸ‰ (kWh)',
                        data: [jan25, jan26, feb25, predFeb26],
                        backgroundColor: ['#94a3b8', '#2dd4bf', '#94a3b8', '#3b82f6'],
                        borderRadius: 6
                    }]
                }, options:{ plugins:{legend:{display:false}}, responsive:true, maintainAspectRatio:false }});
                document.getElementById('modalPredictionShort').innerHTML = `<strong>[ì „ë…„ ëŒ€ë¹„ ì¶”ì„¸]</strong> ì‘ë…„ 1ì›” ëŒ€ë¹„ ì˜¬í•´ ì¦ê°€ìœ¨(${selectedB.growth}%)ì„ ë°˜ì˜í•  ë•Œ, 2026ë…„ 2ì›” ì˜ˆìƒì¹˜ëŠ” <strong>${predFeb26.toLocaleString()} kWh</strong>ì…ë‹ˆë‹¤.`;
            } else {
                // Annual Pattern: 2025 (Full Year) & 2026 (Jan Only)
                const data26 = Array(12).fill(null);
                data26[0] = selectedB.u26_jan; // Only Jan

                chartInstance = new Chart(ctx, { type:'line', data:{
                    labels:['1ì›”','2ì›”','3ì›”','4ì›”','5ì›”','6ì›”','7ì›”','8ì›”','9ì›”','10ì›”','11ì›”','12ì›”'],
                    datasets:[
                        {label:'2025ë…„ ì‹¤ì¸¡', data:selectedB.history25, borderColor:'#cbd5e1', borderDash:[5,5], fill:false},
                        {label:'2026ë…„ ì‹¤ì¸¡', data:data26, borderColor:'#2dd4bf', backgroundColor:'#2dd4bf', pointRadius:6, spanGaps:false}
                    ]
                }, options:{ responsive:true, maintainAspectRatio:false }});
                document.getElementById('modalAnalysisLong').innerHTML = `ì‘ë…„(2025)ì˜ ì—°ê°„ íŒ¨í„´ì„ ë¹„êµí•˜ì—¬ ê±´ë¬¼ì˜ ê³„ì ˆì  íŠ¹ì„±ì„ ë¶„ì„í•©ë‹ˆë‹¤. 2026ë…„ì€ 1ì›” ì‹¤ì¸¡ê°’ë§Œ í‘œì‹œë©ë‹ˆë‹¤.`;
            }
        }

        // --- Admin & Utils ---
        function adminLogin() {
            const p = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸:");
            if(p==="4610") document.getElementById('excelInput').click();
            else if(p!==null) alert("ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜");
        }
        function viewApplicants() {
            const p = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸:");
            if(p==="4610") {
                if(applicants.length===0) alert("ì‹ ì²­ì ì—†ìŒ");
                else {
                    let msg = "=== ì‹ ì²­ì ëª…ë‹¨ ===\n";
                    applicants.forEach((a,i) => {
                        msg += `${i+1}. [${a.building}] ${a.name} (${a.major}, ${a.id})\n`;
                    });
                    alert(msg);
                }
            } else if(p!==null) alert("ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜");
        }
        function openApplyModal(preSelectBuilding = '') { 
            document.getElementById('applyModal').classList.add('active'); 
            if(preSelectBuilding) document.getElementById('appBuilding').value = preSelectBuilding;
        }
        function closeApplyModal() { document.getElementById('applyModal').classList.remove('active'); }
        function openCancelModal() { document.getElementById('cancelModal').classList.add('active'); }
        function closeCancelModal() { document.getElementById('cancelModal').classList.remove('active'); }
        
        function submitApplication(e) {
            e.preventDefault();
            const building = document.getElementById('appBuilding').value;
            
            // Check Duplicate
            if(applicants.some(a => a.building === building)) {
                alert("í•´ë‹¹ ê±´ë¬¼ì€ ì‹ ì²­ì´ ë§ˆê°ëœ ê±´ë¬¼ì…ë‹ˆë‹¤.");
                return;
            }

            applicants.push({
                building: building,
                name: document.getElementById('appName').value,
                major: document.getElementById('appMajor').value,
                id: document.getElementById('appId').value,
                team: document.getElementById('appTeamSize').value,
                phone: document.getElementById('appPhone').value
            });
            alert("ì½”ì¸ ìº í˜ì¸ì„ ì°¸ì—¬í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤ ! ì •ìƒì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.");
            closeApplyModal();
            e.target.reset();
        }

        function submitCancel() {
            const buildingToCancel = document.getElementById('cancelBuilding').value;
            const repName = document.getElementById('cancelName').value;
            
            const index = applicants.findIndex(a => a.building === buildingToCancel);
            
            if (index > -1) {
                if(applicants[index].name === repName) {
                    applicants.splice(index, 1);
                    alert("ì •ìƒì ìœ¼ë¡œ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.");
                    closeCancelModal();
                } else {
                    alert("ëŒ€í‘œì ì´ë¦„ì´ ë‹¤ë¦…ë‹ˆë‹¤.");
                }
            } else {
                alert("í•´ë‹¹ ê±´ë¬¼ë¡œ ì‹ ì²­ëœ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.");
            }
        }

        function handleFileUpload() {
            alert("ê´€ë¦¬ì: ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ (ì‹œë®¬ë ˆì´ì…˜)");
        }

        function getIcon(n) { if(n.includes("ê¸°ìˆ™ì‚¬"))return "fa-bed"; if(n.includes("ë„ì„œê´€"))return "fa-book-open"; if(n.includes("ê³¼í•™")||n.includes("ë™ë¬¼")||n.includes("ìˆ˜ì˜")||n.includes("ìƒëª…"))return "fa-flask"; if(n.includes("ê³µí•™")||n.includes("ê±´ì¶•")||n.includes("ì°½ì˜"))return "fa-microchip"; return "fa-building-columns"; }
        function populateDropdown() { const s=document.getElementById('globalSearch'); [...buildingDB].sort((a,b)=>a.name.localeCompare(b.name)).forEach(b=>{const o=document.createElement('option');o.value=b.name;o.text=b.name;s.appendChild(o)}); }
        
        function scrollToBuilding(n){ 
            if(!n)return; 
            switchPage('dashboard'); 
            setTimeout(()=>{
                const t=document.querySelector(`div[data-id="${n}"]`); 
                if(t) {
                    t.scrollIntoView({behavior:'smooth',block:'center'});
                    t.classList.add('highlighted-card');
                    setTimeout(()=>t.classList.remove('highlighted-card'), 2000);
                }
            },100); 
        }
        
        function populateAISelect(){const s=document.getElementById('aiBuildingSelect');buildingDB.forEach((b,i)=>{const o=document.createElement('option');o.value=i;o.text=b.name;s.appendChild(o)});}
        function filterGrid(c) { 
            const filtered = c==='all'?buildingDB:buildingDB.filter(b=>b.cat===c);
            renderGrid(filtered);
            document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active','bg-white','shadow-sm'));
            event.target.classList.add('active','bg-white','shadow-sm');
        }
    </script>
</body>
</html>